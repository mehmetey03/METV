name: AltÄ±n GÃ¼ncelleme 

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'

concurrency:
  group: altin-guncelleme-${{ github.ref }}
  cancel-in-progress: true

jobs:
  fetch-and-commit:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      # 1. Depoyu Klonla
      - name: Depoyu Klonla (Checkout)
        uses: actions/checkout@v4

      # 2. Playlist'i indir
      - name: Playlist'i Ã‡ek (curl)
        run: |
          curl -L -o indirilen_playlist.m3u \
          "https://goldvod.org/get.php?username=hpgdisco&password=123456&type=m3u_plus&output=m3u" \
          --fail --silent
        continue-on-error: true

      # 3. Commit + Push (Ã‡AKIÅžMASIZ)
      - name: DeÄŸiÅŸiklikleri Depoya GÃ¶nder (Commit)
        run: |
          if [ ! -f indirilen_playlist.m3u ]; then
            echo "indirilen_playlist.m3u yok, commit atlanÄ±yor."
            exit 0
          fi

          git config --global user.name "github-actions[bot]"
          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"

          git add indirilen_playlist.m3u

          # DeÄŸiÅŸiklik yoksa commit atma
          git diff-index --quiet HEAD && {
            echo "DeÄŸiÅŸiklik yok, Ã§Ä±kÄ±lÄ±yor."
            exit 0
          }

          git commit -m "Otomatik GÃ¼ncelleme: M3U playlist yenilendi"

          # ðŸ”´ ASIL KRÄ°TÄ°K SATIR
          git pull --rebase origin main

          git push origin main
